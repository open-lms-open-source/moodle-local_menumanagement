define(["jquery","core/ajax","core/notification","core/str"],function(a,b,c,d){var e=0,f=0;a("#add-item").click(function(){var b=a("#label").val(),c=a("#link").val(),d=a("#id").val(),e=a("#capability_selection").val(),f=0,g={},h=!0;if(g.en=b,a(".multilingual-label").each(function(){var b=a(this).data("id"),c=a('.multilingual-select[data-id="'+b+'"]').val(),d=a('.multilingual-label[data-id="'+b+'"]').val();return void 0!==c&&c.length?void 0!==d&&d.length?void(g[c]=d):(alert("Please input multilingual label"),h=!1,!1):(alert("Please select language"),h=!1,!1)}),!h)return!1;if(a("#adminonly").is(":checked")&&(f=1),a("li[data-id='"+d+"']").length>0){a(".label-text[data-id='"+d+"']").text(b),a(".link-text[data-id='"+d+"']").text(c),a("li[data-id='"+d+"']").attr("data-label",JSON.stringify(g)),a("li[data-id='"+d+"']").attr("data-link",c),a("li[data-id='"+d+"']").attr("data-adminonly",f),a("li[data-id='"+d+"']").attr("data-capability",e);var i=a(".selected-icon i").attr("class");i&&(a("li[data-id='"+d+"']").attr("data-icon",i),a(".label-text[data-id='"+d+"']").html("<i class='"+i+"' style='font-size:15px;'></i>&nbsp;"+b)),a("#label").val(""),a("#link").val(""),a("#id").val(""),a("#add-item").text("Add"),a(".selected-icon i").attr("class","fip-icon-block"),a("#capability_selection")[0].selectize.setValue(""),a("#adminonly").prop("checked",!1)}else{if(""==b)return alert("Please input menu item label"),!1;if(""==c)return alert("Please input menu item link"),!1;var j=[];a(".dd-item").each(function(b){j.push(a(this).attr("data-id"))});var k=Math.max.apply(null,j)+1;a("#new-item .dd-item").attr("data-id",k),a("#new-item .dd-item").attr("data-link",c),a("#new-item .dd-item").attr("data-label",JSON.stringify(g)),a("#new-item .dd-item").attr("data-adminonly",f),a("#new-item .dd-item").attr("data-capability",e);var i=a(".selected-icon i").attr("class");a("#new-item .dd-item").attr("data-icon",i),i?a("#new-item .label-text").html("<i class='"+i+"' style='font-size:15px;'></i>&nbsp;"+b):a("#new-item .label-text").text(b),a("#new-item .link-text").text(c),a("#new-item .label-text").attr("data-id",k),a("#new-item .link-text").attr("data-id",k),a("#new-item .edit-button").attr("data-id",k),a("#new-item .edit-button").attr("id",k),a("#new-item .del-button").attr("data-id",k),a("#new-item .del-button").attr("id",k);var l=a("#new-item").html(),l=l.replace("new-item-only","");a("#menu-id").append(l);var d=a("#new-item .dd-item").attr("data-id");d++,a("#new-item .dd-item").attr("data-id",d),a("#new-item .label-text").attr("data-id",d),a("#new-item .link-text").attr("data-id",d),a("#new-item .edit-button").attr("data-id",d),a("#new-item .del-button").attr("data-id",d),a("#label").val(""),a("#link").val(""),a("#id").val(""),a("#add-item").text("Add"),a(".selected-icon i").attr("class","fip-icon-block"),a("#capability_selection")[0].selectize.setValue(""),a("#adminonly").prop("checked",!1)}}),a("#add-multilingual-row").click(function(){g.addMultilingualRow(null,null)}),a(".edit-button").click(function(){var b=a(this).attr("data-id"),c=a(".label-text[data-id='"+b+"']").text(),d=a(".link-text[data-id='"+b+"']").text(),h=a("li[data-id='"+b+"']"),i=h.attr("data-icon"),j=h.attr("data-adminonly"),k=h.attr("data-capability");a(".multilingual-row-inputs").remove(),e=1;try{var l=JSON.parse(h.attr("data-label"));for(var m in l)"en"!==m&&g.addMultilingualRow(m,l[m]),Object.keys(l).length-1>f&&a("#multilingual-row").show()}catch(n){f>0&&a("#multilingual-row").show()}var o=h.parent();o.is("#menu-id")||(j=0),c=c.replace("&nbsp;",""),c=c.trim(),a("#id").val(b),a("#label").val(c),a("#link").val(d),a(".selected-icon i").attr("class",i),1==j?a("#adminonly").prop("checked",!0):a("#adminonly").prop("checked",!1),a("#capability_selection")[0].selectize.setValue(k),a("#add-item").text("Update"),a("#label").focus(),a(window).scrollTop(a("#label").position().top)}),a(".reset").click(function(){g.reset()});var g={init:function(){e++,f=Object.keys(langs).length},addMultilingualRow:function(b,c){d.get_strings([{key:"label",component:"local_menumanagement"},{key:"multilingual_label",component:"local_menumanagement"},{key:"select",component:"local_menumanagement"}]).then(function(d){var g=[];g.push('<option value = "">'+d[2]+"</option>");for(var h in langs){var i='<option value = "'+h+'"';b===h&&(i+=" selected"),i+=">"+langs[h]+"</option>",g.push(i)}var j='<input type="text" id="label-'+e+'" data-id = "'+e+'" placeholder="'+d[1]+'" class="form-control input-blank multilingual-label"';null!==c&&(j+=' value = "'+c+'"'),j+=">",a("#multilingual-row").before('<div class = "row multilingual-row-inputs"><label for="label">'+d[0]+":</label>"+j+'<select name = "language-'+e+'" data-id = "'+e+'" id = "language-'+e+'" class = "multilingual-select">'+g+"</select></div>"),e>=f?a("#multilingual-row").hide():a("#multilingual-row").show(),e++})},reset:function(){a("#label").val(""),a("#link").val(""),a("#id").val(""),a("#add-item").text("Add"),a(".selected-icon i").attr("class","fip-icon-block"),a("#capability_selection")[0].selectize.setValue(""),a("#adminonly").prop("checked",!1),a(".multilingual-row-inputs").remove(),e=1,f>0&&a("#multilingual-row").show()}};return g});