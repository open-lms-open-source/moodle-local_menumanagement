define(["jquery","core/ajax","core/notification","core/str"],function(a,b,c,d){var e=0,f=0,g=0;a("#add-item").click(function(){var b=a("#label").val(),c=a("#link").val(),d=a("#id").val(),e=a("#capability_selection").val(),f=0,g={},i=!0;if(g.en=b,a(".multilingual-label").each(function(){var b=a(this).data("id"),c=a('.multilingual-select[data-id="'+b+'"]').val(),d=a('.multilingual-label[data-id="'+b+'"]').val();return void 0!==c&&c.length?void 0!==d&&d.length?void(g[c]=d):(alert("Please input multilingual label"),i=!1,!1):(alert("Please select language"),i=!1,!1)}),!i)return!1;if(a("#adminonly").is(":checked")&&(f=1),a("li[data-id='"+d+"']").length>0){a(".label-text[data-id='"+d+"']").text(b),a(".link-text[data-id='"+d+"']").text(c),a("li[data-id='"+d+"']").attr("data-label",JSON.stringify(g)),a("li[data-id='"+d+"']").attr("data-link",c),a("li[data-id='"+d+"']").attr("data-adminonly",f),a("li[data-id='"+d+"']").attr("data-capability",e);var j=a(".selected-icon i").attr("class");j&&(a("li[data-id='"+d+"']").attr("data-icon",j),a(".label-text[data-id='"+d+"']").html("<i class='"+j+"' style='font-size:15px;'></i>&nbsp;"+b)),a("#label").val(""),a("#link").val(""),a("#id").val(""),a("#add-item").text("Add"),a(".selected-icon i").attr("class","fip-icon-block"),a("#capability_selection")[0].selectize.setValue(""),a("#adminonly").prop("checked",!1),h.reset()}else{if(""==b)return alert("Please input menu item label"),!1;if(""==c)return alert("Please input menu item link"),!1;var k=[];a(".dd-item").each(function(b){k.push(a(this).attr("data-id"))});var l=Math.max.apply(null,k)+1;a("#new-item .dd-item").attr("data-id",l),a("#new-item .dd-item").attr("data-link",c),a("#new-item .dd-item").attr("data-label",JSON.stringify(g)),a("#new-item .dd-item").attr("data-adminonly",f),a("#new-item .dd-item").attr("data-capability",e);var j=a(".selected-icon i").attr("class");a("#new-item .dd-item").attr("data-icon",j),j?a("#new-item .label-text").html("<i class='"+j+"' style='font-size:15px;'></i>&nbsp;"+b):a("#new-item .label-text").text(b),a("#new-item .link-text").text(c),a("#new-item .label-text").attr("data-id",l),a("#new-item .link-text").attr("data-id",l),a("#new-item .edit-button").attr("data-id",l),a("#new-item .edit-button").attr("id",l),a("#new-item .del-button").attr("data-id",l),a("#new-item .del-button").attr("id",l);var m=a("#new-item").html(),m=m.replace("new-item-only","");a("#menu-id").append(m);var d=a("#new-item .dd-item").attr("data-id");d++,a("#new-item .dd-item").attr("data-id",d),a("#new-item .label-text").attr("data-id",d),a("#new-item .link-text").attr("data-id",d),a("#new-item .edit-button").attr("data-id",d),a("#new-item .del-button").attr("data-id",d),a("#label").val(""),a("#link").val(""),a("#id").val(""),a("#add-item").text("Add"),a(".selected-icon i").attr("class","fip-icon-block"),a("#capability_selection")[0].selectize.setValue(""),a("#adminonly").prop("checked",!1),h.reset()}}),a("#add-multilingual-row").click(function(){h.addMultilingualRow(null,null)}),a(".edit-button").click(function(){var b=a(this).attr("data-id"),c=a(".label-text[data-id='"+b+"']").text(),d=a(".link-text[data-id='"+b+"']").text(),g=a("li[data-id='"+b+"']"),i=g.attr("data-icon"),j=g.attr("data-adminonly"),k=g.attr("data-capability");a(".multilingual-row-inputs").remove(),e=1;try{var l=JSON.parse(g.attr("data-label"));for(var m in l)"en"!==m&&h.addMultilingualRow(m,l[m]),Object.keys(l).length-1>f&&a("#multilingual-row").show()}catch(n){f>0&&a("#multilingual-row").show()}var o=g.parent();o.is("#menu-id")||(j=0),c=c.replace("&nbsp;",""),c=c.trim(),a("#id").val(b),a("#label").val(c),a("#link").val(d),a(".selected-icon i").attr("class",i),1==j?a("#adminonly").prop("checked",!0):a("#adminonly").prop("checked",!1),a("#capability_selection")[0].selectize.setValue(k),a("#add-item").text("Update"),a("#label").focus(),a(window).scrollTop(a("#label").position().top)}),a(".reset").click(function(){h.reset()});var h={init:function(){e++,f=Object.keys(langs).length},addMultilingualRow:function(b,c){d.get_strings([{key:"label",component:"local_menumanagement"},{key:"multilingual_label",component:"local_menumanagement"},{key:"select",component:"local_menumanagement"},{key:"language",component:"local_menumanagement"}]).then(function(d){var h=[];h.push('<option value = "">'+d[2]+"</option>");for(var i in langs){var j='<option value = "'+i+'"';b===i&&(j+=" selected"),j+=">"+langs[i]+"</option>",h.push(j)}var k='<input type="text" id="label-'+e+'" data-id = "'+e+'" placeholder="'+d[1]+'" class="col-10 mx-3 form-control"';null!==c&&(k+=' value = "'+c+'"'),k+=">",a("#get-capability").before('<div class = "row multilingual-row multilingual-row-inputs"><div class = "col-6 mt-3"><div class = "form-group row" id ="multilingual-text"><label for="label" class = "col-10 mx-3 form-control">'+d[0]+":</label>"+k+'</div></div></div><div class = "row multilingual-row multilingual-row-inputs"><div class = "col-6 mt-3"><div class = "form-group row"><label for="label" class = "col-10 mx-3 form-control">'+d[3]+':</label><select name = "language-'+e+'" data-id = "'+e+'" id = "language-'+e+'" class = "col-10 mx-3 form-control">'+h+"</select></div></div></div>"),g++,g>=f&&(document.getElementById("add-multilingual-row").disabled=!0),e++})},reset:function(){a("#label").val(""),a("#link").val(""),a("#id").val(""),a(".selected-icon i").attr("class","fip-icon-block"),a("#capability_selection")[0].selectize.setValue(""),a("#adminonly").prop("checked",!1),a(".multilingual-row-inputs").remove(),e=1,f>0&&(a("#multilingual-row").show(),document.getElementById("add-multilingual-row").disabled=!1,g=0)}};return h});